export function generateWorkbookHTML(t,n,a,e){const o=(new Date).toLocaleString(),r=a.workbookName||"Workbook",d=`\n    <style>\n        :root {\n            --bs-body-bg: #ffffff;\n            --bs-body-color: #212529;\n            --bs-primary: #0d6efd;\n            --bs-border-color: #dee2e6;\n            --dv-header-bg: #f8f9fa;\n        }\n        [data-bs-theme="dark"] {\n            --bs-body-bg: #212529;\n            --bs-body-color: #f8f9fa;\n            --bs-border-color: #495057;\n            --dv-header-bg: #2c3034;\n        }\n        body { \n            font-family: 'Segoe UI', sans-serif; \n            margin: 0; padding: 0; \n            background-color: var(--bs-body-bg); color: var(--bs-body-color);\n            overflow-x: hidden; \n            width: 100vw;\n        }\n        \n        /* Dashboard Styles */\n        .dashboard-container { max-width: 1200px; margin: 50px auto; text-align: center; }\n        .dashboard-title { font-size: 2.5rem; font-weight: 300; margin-bottom: 10px; }\n        .dashboard-meta { color: gray; }\n        \n        .sheet-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }\n        .sheet-card {\n            background: var(--bs-body-bg);\n            border: 1px solid var(--bs-border-color);\n            border-radius: 8px;\n            padding: 30px;\n            cursor: pointer;\n            transition: transform 0.2s;\n            width: 280px;\n        }\n        .sheet-card:hover { transform: translateY(-5px); border-color: var(--bs-primary); }\n        .sheet-name { font-size: 1.2rem; font-weight: 500; margin-top: 15px; }\n\n        /* Sheet View Styles */\n        .view-section { display: none; padding-top: 0; }\n        .view-section.active { display: block; }\n\n        .sheet-header {\n            display: flex; align-items: center; justify-content: space-between;\n            background: var(--dv-header-bg); padding: 10px 20px;\n            border-bottom: 1px solid var(--bs-border-color); margin-bottom: 20px;\n        }\n        .btn-back { cursor: pointer; font-weight: 600; text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px; }\n\n        /* === PRECISION HEADER & FILTERS === */\n        .dv-table-wrapper { width: 100%; margin-bottom: 2rem; position: relative; }\n        \n        /* Header Styling */\n        table.dataTable thead tr:first-child th {\n            background: var(--dv-header-bg) !important;\n            padding: 12px 18px !important;\n            font-weight: 700 !important;\n            border-bottom: 2px solid var(--bs-border-color) !important;\n            vertical-align: middle !important;\n        }\n        \n        /* Filter Row Styling */\n        .filter-row th {\n            padding: 4px 10px !important;\n            background: var(--bs-body-bg) !important;\n            border-bottom: 1px solid var(--bs-border-color) !important;\n            line-height: 1 !important;\n        }\n\n        .filter-input { width: 100%; border: 1px solid var(--bs-border-color); padding: 5px 10px; font-size: 0.75rem; border-radius: 6px; outline: none; transition: border-color 0.2s; }\n        .filter-input:focus { border-color: #00bcd4; box-shadow: 0 0 0 2px rgba(0, 188, 212, 0.1); }\n\n        /* SearchPanes Styling */\n        .dtsp-searchPanes { margin-bottom: 1.5rem; border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 15px; background: var(--bs-body-bg); }\n\n        .dv-controls-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 12px; }\n        .dv-search-group { display: flex; align-items: center; gap: 15px; }\n        .dv-summary-stats { display: flex; gap: 10px; font-size: 0.85rem; color: var(--bs-secondary-color); border-right: 1px solid var(--bs-border-color); padding-right: 15px; }\n        .dv-stat-badge { background: var(--bs-secondary-bg); padding: 2px 8px; border-radius: 4px; font-weight: 600; color: #00bcd4; }\n\n        /* Unified Button Group Styling (v11.0) */\n        .dt-buttons {\n            display: inline-flex !important;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            border-radius: 8px;\n            overflow: hidden;\n            border: 1px solid var(--bs-border-color);\n        }\n        .btn-advanced-filters, .dt-button {\n            margin: 0 !important;\n            border: none !important;\n            border-radius: 0 !important;\n            padding: 8px 18px !important;\n            font-size: 0.85rem !important;\n            height: 38px;\n            display: flex;\n            align-items: center;\n            font-weight: 500 !important;\n            transition: all 0.2s !important;\n        }\n        .btn-advanced-filters {\n            background-color: #00bcd4 !important;\n            color: white !important;\n            border-right: 1px solid rgba(0,0,0,0.1) !important;\n        }\n        .dt-button {\n            background-color: #6c757d !important;\n            color: white !important;\n            border-right: 1px solid rgba(255,255,255,0.1) !important;\n        }\n        .dt-button:last-child { border-right: none !important; }\n        .dt-button:hover { background-color: #5a6268 !important; }\n        .btn-advanced-filters:hover { background-color: #00acc1 !important; }\n\n        .dataTables_scrollBody { border: 1px solid var(--bs-border-color); border-radius: 0 0 8px 8px; }\n        .dataTables_scrollHead { border: 1px solid var(--bs-border-color); border-bottom: none; border-radius: 8px 8px 0 0; background: var(--dv-header-bg); }\n\n        table.dataTable { width: 100% !important; margin: 0 !important; table-layout: auto !important; border-collapse: collapse !important; }\n        table.dataTable th, table.dataTable td { white-space: nowrap !important; vertical-align: middle; padding: 12px 18px !important; border: 1px solid var(--bs-border-color); min-width: 120px; }\n\n        .dataTables_paginate { display: flex; justify-content: flex-end; margin-top: 10px; font-size: 0.8rem; }\n        \n        /* RICH FORMATTING */\n        .dv-pos { color: #28a745 !important; font-weight: 600; }\n        .dv-neg { color: #dc3545 !important; font-weight: 600; }\n        .dv-card { background: var(--bs-body-bg); border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }\n    </style>\n    <style>${e.css||""}</style>\n    `,i=[];return i.push(`<!DOCTYPE html><html lang="en" data-bs-theme="light"><head><meta charset="UTF-8"><title>${r}</title>${d}</head><body>`),i.push(`\n    <div id="dashboard-view" class="view-section active">\n        <div class="dashboard-container">\n            <div class="dashboard-header">\n                <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 20px;">\n                    <img src="https://Harry-0402.github.io/DataVista/assets/icon-32.png" width="32" height="32" style="margin-right: 10px;">\n                    DataVista Report\n                </div>\n                <h1 class="dashboard-title">${r}</h1>\n                <p class="dashboard-meta">Generated on ${o} &bull; ${n.length} Sheets &bull; v1.2.1 (Analytics Edition)</p>\n            </div>\n            <div class="sheet-grid">\n    `),n.forEach((t,n)=>{i.push(`\n        <div class="sheet-card" onclick="showSheet('${n}')">\n            <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>\n            <div class="sheet-name">${t}</div>\n        </div>\n        `)}),i.push("</div></div></div>"),n.forEach((n,a)=>{const e=t[n],o=e.length>0?e[0]:[],r=e.length>0?e.slice(1).filter(t=>t.some(t=>null!=t&&""!==t.toString().trim())):[],d=o.length;let s=1;d>6&&(s=Math.max(.75,1-.04*(d-6)));const l=s.toFixed(2)+"rem";i.push(`\n        <div id="sheet-view-${a}" class="view-section">\n            <div class="sheet-header">\n                <a class="btn-back" onclick="showDashboard()">\n                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>\n                    Back to Dashboard\n                </a>\n                <div style="font-weight: bold;">${n}</div>\n                <div onclick="document.documentElement.setAttribute('data-bs-theme', document.documentElement.getAttribute('data-bs-theme')==='dark'?'light':'dark')" style="cursor: pointer;">Theme</div>\n            </div>\n            <div class="container-fluid" style="padding: 0 20px;">\n                <ul class="nav nav-pills mb-3 justify-content-center" role="tablist">\n                    <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#sheet-${a}-data">Data</a></li>\n                    <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#sheet-${a}-stats">Analytics</a></li>\n                </ul>\n                <div class="tab-content">\n                    <div id="sheet-${a}-data" class="tab-pane fade show active">\n                        <div class="dv-table-wrapper">\n                            <table class="table table-striped table-hover display table-bordered" style="width:100% !important; font-size:${l};">\n                                <thead>\n                                    <tr>${o.map(t=>`<th>${t||""}</th>`).join("")}</tr>\n                                    <tr class="filter-row">${o.map(()=>"<th></th>").join("")}</tr>\n                                </thead>\n                                <tbody>\n                                    ${r.map(t=>`<tr>${t.map(t=>`<td>${t||""}</td>`).join("")}</tr>`).join("")}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                    <div id="sheet-${a}-stats" class="tab-pane fade">\n                        <div class="row">\n                            <div class="col-md-4">\n                                <div class="dv-card mb-3">\n                                    <h6>Metadata</h6>\n                                    <p class="small mb-1 text-muted">Total Rows: <strong>${r.length}</strong></p>\n                                    <p class="small mb-1 text-muted">Total Columns: <strong>${o.length}</strong></p>\n                                    <p class="small mb-3 text-muted">Sheet: <strong>${n}</strong></p>\n                                    <div class="alert alert-secondary py-2 small">Analytics calculated on raw selection.</div>\n                                </div>\n                            </div>\n                            <div class="col-md-8">\n                                <div class="dv-card">\n                                    <h6>Column Statistics</h6>\n                                    <div class="table-responsive">\n                                        <table class="table table-sm small">\n                                            <thead><tr><th>Column</th><th>Sum</th><th>Avg</th></tr></thead>\n                                            <tbody>\n                                                ${o.map((t,n)=>{const a=r.map(t=>{const a=t[n],e=parseFloat(a?.toString().replace(/[^0-9.-]+/g,""));return isNaN(e)?null:e}).filter(t=>null!==t);if(0===a.length)return"";const e=a.reduce((t,n)=>t+n,0);return`<tr><td>${t}</td><td>${e.toLocaleString()}</td><td>${(e/a.length).toLocaleString()}</td></tr>`}).join("")}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `)}),i.push('\n    <div class="modal fade" id="searchBuilderModal" tabindex="-1"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-body" id="sb-modal-body"></div></div></div></div>\n    '),i.push(`<script>${e.js||""}<\/script>`),i.push("<script>\n        function showDashboard() { $('.view-section').removeClass('active'); $('#dashboard-view').addClass('active'); }\n        function showSheet(index) {\n            $('.view-section').removeClass('active');\n            $('#sheet-view-' + index).addClass('active');\n            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();\n        }\n\n        $(document).ready(function () {\n            $('table.display').each(function () {\n                var table = $(this);\n                table.DataTable({\n                    dom: 'P<\"dv-controls-row\"B<\"dv-search-group\"f>>t<\"row mt-3\"<\"col-md-6\"i><\"col-md-6\"p>>',\n                    orderCellsTop: true,\n                    searchPanes: { cascadePanes: true, viewTotal: true, layout: 'columns-3' },\n                    autoWidth: false, scrollX: true, scrollCollapse: true, pageLength: 20,\n                    rowCallback: function (row, data) {\n                        $('td', row).each(function () {\n                            var text = $(this).text().trim();\n                            var val = parseFloat(text.replace(/[^0-9.-]+/g, \"\"));\n                            if (!isNaN(val) && !text.includes('/') && !text.includes('-20') && text.length < 15) {\n                                if (val > 0) $(this).addClass('dv-pos');\n                                else if (val < 0) $(this).addClass('dv-neg');\n                            }\n                        });\n                    },\n                    buttons: [\n                        {\n                            text: 'Advanced Filters', className: 'btn-advanced-filters',\n                            action: function (e, dt) {\n                                $('#sb-modal-body').empty();\n                                var sb = new $.fn.dataTable.SearchBuilder(dt, {});\n                                $('#sb-modal-body').append(sb.getNode());\n                                $('#searchBuilderModal').modal('show');\n                            }\n                        },\n                        'copy', 'csv', 'excel', 'pdf', 'print', 'colvis'\n                    ],\n                    initComplete: function () {\n                        var api = this.api();\n                        var rowCount = api.rows().count();\n                        var colCount = api.columns().count();\n                        var statsHtml = '<div class=\"dv-summary-stats\">' +\n                            '<span>Total Rows: <span class=\"dv-stat-badge\">' + rowCount + '</span></span>' +\n                            '<span>Total Columns: <span class=\"dv-stat-badge\">' + colCount + '</span></span>' +\n                            '</div>';\n                        $(this).closest('.dv-table-wrapper').find('.dv-search-group').prepend(statsHtml);\n\n                        $(api.table().header()).find('tr.filter-row th').each(function (colIdx) {\n                            $('<input type=\"text\" class=\"filter-input\" placeholder=\"Filter...\" />')\n                                .appendTo(this)\n                                .on('keyup change', function (e) {\n                                    e.stopPropagation();\n                                    api.column(colIdx).search(this.value).draw();\n                                });\n                        });\n                        setTimeout(function () { api.columns.adjust(); }, 150);\n                    }\n                });\n            });\n        });\n    <\/script></body></html>"),new Blob([i.join("")],{type:"text/html"})}